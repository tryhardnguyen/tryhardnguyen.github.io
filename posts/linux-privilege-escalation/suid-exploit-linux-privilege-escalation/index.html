<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Exploring SUID Exploit - Linux Privilege Escalation - </title><meta name="Description" content="I am exploring SUID exploit which is often used in privilege escalation. To help me learn the material, I will be using TryHackMe room as my lab."><meta property="og:title" content="Exploring SUID Exploit - Linux Privilege Escalation" />
<meta property="og:description" content="I am exploring SUID exploit which is often used in privilege escalation. To help me learn the material, I will be using TryHackMe room as my lab." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/linux-privilege-escalation/suid-exploit-linux-privilege-escalation/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-25T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-06-25T00:00:00+00:00" /><meta property="og:site_name" content="SecurityNguyen Site" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Exploring SUID Exploit - Linux Privilege Escalation"/>
<meta name="twitter:description" content="I am exploring SUID exploit which is often used in privilege escalation. To help me learn the material, I will be using TryHackMe room as my lab."/>
<meta name="application-name" content="SecurityNguyen">
<meta name="apple-mobile-web-app-title" content="SecurityNguyen"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="/posts/linux-privilege-escalation/suid-exploit-linux-privilege-escalation/" /><link rel="prev" href="/posts/linux-privilege-escalation/sudo-linux-privilege-escalation/" /><link rel="next" href="/posts/linux-privilege-escalation/capabilities-linux-privilege-escalation/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Exploring SUID Exploit - Linux Privilege Escalation",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "\/posts\/linux-privilege-escalation\/suid-exploit-linux-privilege-escalation\/"
        },"genre": "posts","keywords": "Red Team, Linux","wordcount":  775 ,
        "url": "\/posts\/linux-privilege-escalation\/suid-exploit-linux-privilege-escalation\/","datePublished": "2023-06-25T00:00:00+00:00","dateModified": "2023-06-25T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Nguyen Nguyen"
            },"description": "I am exploring SUID exploit which is often used in privilege escalation. To help me learn the material, I will be using TryHackMe room as my lab."
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="">SecurityNguyen</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="/categories/"> Categories </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="">SecurityNguyen</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="/categories/" title="">Categories</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Exploring SUID Exploit - Linux Privilege Escalation</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://github.com/tryhardnguyen" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Nguyen Nguyen</a></span>&nbsp;<span class="post-category">included in <a href="/categories/penetration-testing/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Penetration Testing</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2023-06-25">2023-06-25</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;775 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;4 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-suid">What is SUID?</a></li>
    <li><a href="#question">Question</a></li>
    <li><a href="#adding-user-to-escalate-privilege">Adding user to escalate privilege.</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><style>
	.zoom {
	            transition: transform 0.3s;
	            cursor: pointer;
	        }
	        
	        .overlay {
	            position: fixed;
	            top: 0;
	            left: 0;
	            width: 100%;
	            height: 100%;
	            background-color: rgba(0, 0, 0, 0.5);
	            display: none;
	            justify-content: center;
	            align-items: center;
	            z-index: 999;
	            pointer-events: none;
	        }
	        
	        .zoomed-image {
	            max-width: 80%;
	            max-height: 80%;
	            transition: transform 0.3s;
	        }
	        
	        .zoomed-image.zoomed {
	            transform: scale(1.5);
	        }
</style>
<h2 id="what-is-suid">What is SUID?</h2>
<p>To understand SUID, we have to first introduce the basic privilege: Read (r), Write (w), and Execute (x).
<br>
<br>
SUID stand for &ldquo;Set owner User ID&rdquo; aka Said permission. In the <code>ls -al</code>, it is denoted as <code>&quot;s&quot;</code> in the permission.
<br>
For example: <code>-rswr-xr-x</code></p>
<p>This permission is special and isn&rsquo;t your typical basic privilege. SUID allows the file to have temporary elevated permission during execution and that permission is equal to the permission of the owner of the file.
<br>
For example:
<br>
<img class="zoom" src="/images/linux_priv_13.png"></p>
<div class="overlay">
        <img class="zoomed-image" src="/images/linux_priv_13.png">
</div>
<br>
From the picture above, we can see that /bin/nano has a SUID bit set (-rwsr-xr-x) this mean that whenever nano is run, it running with root privilege hence we don't even need to run it with sudo. This allows the attacker to briefly escalate their privilege temporary. This is awesome, but how can we find files, programs, commands that have SUID bits? We can use this command:
`find / -type f -perm -04000 -ls 2>/dev/null`
<p>&ldquo;A good practice would be to compare executables on this list with GTFOBins (<a href="https://gtfobins.github.io/" target="_blank" rel="noopener noreffer ">https://gtfobins.github.io</a>). Clicking on the SUID button will filter binaries known to be exploitable when the SUID bit is set (you can also use this link for a pre-filtered list <a href="https://gtfobins.github.io/#&#43;suid" target="_blank" rel="noopener noreffer ">https://gtfobins.github.io/#+suid</a>).&rdquo; - TryHackMe</p>
<p>If you&rsquo;re having trouble understanding SUID, I have a diagram to help you understand:
<br>
<img class="zoom" src="/images/linux_priv_14.png"></p>
<div class="overlay">
        <img class="zoomed-image" src="/images/linux_priv_14.png">
</div>
<br>
However, the main goal of this exploit is to find a way to **escalate our privilege permanently**. In case of nano, we can try to either brute force a user or we can add an account to the /etc/passwd and give the account we created root access.
<br>
<br>
Let's explore the option of brute forcing a user. I will be using the [TryHackMe Linux Privilege Escalation Room](https://tryhackme.com/room/linprivesc)
<br>
<br>
The first thing I'm going to do is find any command that have SUID bits on. I'm going execute this command: `find / -type f -perm -04000 -ls 2>/dev/null`. Here are the result:
<br>
<img class="zoom" src="/images/linux_priv_15.png">
<div class="overlay">
        <img class="zoomed-image" src="/images/linux_priv_15.png">
</div>
<br>
There was more files on top but I only included the part I found helpful to me. Now, I will go to [GTFOBins](https://gtfobins.github.io/) and only focus on SUID. To only focus on SUID, you can just click on the button and it should filter only binaries that are exploited using SUID. Now, we are going to compare our result to the GTFOBins and see if there is any binary we can use.
<br>
<br>
For me, I chose `/usr/bin/base64`. When you're on [base64 page](https://gtfobins.github.io/gtfobins/base64/#suid) it will show you the proof of concept for SUID exploit. Now, I'm going to check if I can access `/etc/shadow` using base64. 
<br>
<br>
This is the command I'm going to run: `base64 /etc/shadow | base64 --decode`
<br>
<br>
```
$ base64 /etc/shadow | base64 --decode
gerryconway:$6$vgzgxM3ybTlB.wkV$48YDY7qQnp4purOJ19mxfMOwKt.H2LaWKPu0zKlWKaUMG1N7weVzqobp65RxlMIZ/NirxeZdOJMEOp3ofE.RT/:18796:0:99999:7:::
user2:$6$m6VmzKTbzCD/.I10$cKOvZZ8/rsYwHd.pE099ZRwM686p/Ep13h7pFMBCG4t7IukRqc/fXlA1gHXh9F2CbwmD4Epi1Wgh.Cl.VV1mb/:18796:0:99999:7:::
lxd:!:18796::::::
karen:$6$VjcrKz/6S8rhV4I7$yboTb0MExqpMXW0hjEJgqLWs/jGPJA7N/fEoPMuYLY1w16FwL7ECCbQWJqYLGpy.Zscna9GILCSaNLJdBP1p8/:18796:0:99999:7:::
```
<br>
<br>
As we can see from above, we were able to see the content of shadow file.
<h2 id="question">Question</h2>
<p>I wanted to point out that TryHackMe has provided us some question:
<br>
<br>
Which user shares the name of a great comic book writer?
<br>
To find out the answer we need to do &ldquo;base64 /etc/passwd | base64 &ndash;decode&rdquo; and then try out all the user.
<br>
<br>
What is the password of user2?
<br>
We would have to create list of users (passwd) and list of password (shadow) and combine it together using unshadow to create a list we can brute force.
<br>
<br>
Execute <code>base64 /etc/passwd | base64 --decode</code> and add this to the passwd.txt file.
<br>
<img class="zoom" src="/images/linux_priv_16.png"></p>
<div class="overlay">
        <img class="zoomed-image" src="/images/linux_priv_16.png">
</div>
<br>
We are going do the same thing for /etc/shadow but instead we will add the info to shadow.txt
<br>
<br>
Afterward, we are going run: `unshadow passwd.txt shadow.txt > target.txt` and then we are going start brute forcing the user with John the Ripper.
<br>
Command: `john --wordlist=/usr/share/wordlists/rockyou.txt target.txt`
<br>
<br>
Here is the result:
<br>
<img class="zoom" src="/images/linux_priv_17.png">
<div class="overlay">
        <img class="zoomed-image" src="/images/linux_priv_17.png">
</div>
<br>
We were able to crack the password of users2 and gerryconway.
<br>
<br>
What is the content of the flag3.txt file?
<br>
flag3 is in /home/ubuntu. All we have to do is `base64 /home/ubuntu/flag3.txt | base64 --decode`
<br>
<br>
The flag is `THM-3847834`
<h2 id="adding-user-to-escalate-privilege">Adding user to escalate privilege.</h2>
<p>Since we know that nano has a SUID bit set, giving us the ability to read and write with root privilege. We can edit the /etc/passwd file and create a user and give it root privilege.
<br>
<br>
<em><strong>Note: All of the material below is from TryHackMe Linux Privilege escalation</strong></em>
<br>
<br>
We will need the hash value of the password we want the new user to have. This can be done quickly using the openssl tool on Kali Linux.
<br>
<img class="zoom" src="/images/linux_priv_18.png"></p>
<div class="overlay">
        <img class="zoomed-image" src="/images/linux_priv_18.png">
</div>
<br>
We will then add this password with a username (hacker) to the `/etc/passwd` file
<br>
<img class="zoom" src="/images/linux_priv_19.png">
<div class="overlay">
        <img class="zoomed-image" src="/images/linux_priv_19.png">
</div>
<br>
Once our user is added (please note how `root:/bin/bash` was used to provide a root shell) we will need to switch to this user and hopefully should have root privileges.
<br>
<img class="zoom" src="/images/linux_priv_20.png">
<div class="overlay">
        <img class="zoomed-image" src="/images/linux_priv_20.png">
</div>
<br>
That is all I have, thanks for reading.
<!-- Zoom Animation Feature -->
<script>
	const zooms = document.querySelectorAll('.zoom');
	const overlay = document.querySelector('.overlay');
	const zoomedImage = document.querySelector('.zoomed-image');
	
	zooms.forEach(function(zoom) {
		zoom.addEventListener('click', function() {
			overlay.style.display = 'flex';
			overlay.style.pointerEvents = 'auto';
			zoomedImage.src = zoom.src;
			zoomedImage.classList.add('zoomed');
		});
	});
	
	overlay.addEventListener('click', function() {
		overlay.style.display = 'none';
		overlay.style.pointerEvents = 'none';
		zoomedImage.classList.remove('zoomed');
	});
</script></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-06-25</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="/posts/linux-privilege-escalation/suid-exploit-linux-privilege-escalation/" data-title="Exploring SUID Exploit - Linux Privilege Escalation" data-hashtags="Red Team,Linux"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="/posts/linux-privilege-escalation/suid-exploit-linux-privilege-escalation/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/red-team/">Red Team</a>,&nbsp;<a href="/tags/linux/">Linux</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/linux-privilege-escalation/sudo-linux-privilege-escalation/" class="prev" rel="prev" title="sudo - Linux Privilege Escalation"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>sudo - Linux Privilege Escalation</a>
            <a href="/posts/linux-privilege-escalation/capabilities-linux-privilege-escalation/" class="next" rel="next" title="Capabilities - Linux Privilege Escalation">Capabilities - Linux Privilege Escalation<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.111.3">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/tryhardnguyen" target="_blank">Nguyen Nguyen</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"lightgallery":true,"twemoji":true};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
